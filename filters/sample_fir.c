#include "sample_fir.h"

static double filter_taps[SAMPLEFILTER_TAP_NUM] = {
  -0.01482969765384599,
  -0.06033776434504067,
  -0.06396748769382216,
  0.01630770123311275,
  0.024742761850908904,
  -0.028067038576290372,
  0.009888252520662215,
  0.009308722245391797,
  -0.018456893922803082,
  0.01623436323498324,
  -0.006936909349831065,
  -0.0036140986284399594,
  0.010970799718855274,
  -0.01315570140351435,
  0.010416969763421885,
  -0.004570678192305025,
  -0.0020135585239935794,
  0.007246328530967606,
  -0.009849171183218913,
  0.009460202202241308,
  -0.00656359581796631,
  0.00226460953114351,
  0.0022731723795717386,
  -0.0059569232113415305,
  0.008009303921807376,
  -0.008090051753305738,
  0.0063703306589316,
  -0.003349717219829301,
  -0.00027385553960806265,
  0.0036816362417962586,
  -0.006221168445066929,
  0.007458508129006677,
  -0.007197971275386966,
  0.005527286968937268,
  -0.0028124490554282846,
  -0.0004086036221954815,
  0.003566617523000023,
  -0.00605841222220879,
  0.00745577248578239,
  -0.007549771185039846,
  0.006280343042208815,
  -0.003815463498340431,
  0.0005838654280414387,
  0.0028598846625958905,
  -0.005908484547987026,
  0.008067986819280814,
  -0.008814738032636556,
  0.008199110786132604,
  -0.005936673826703775,
  0.0026165710564311005,
  0.0015206679529247257,
  -0.005537615079614365,
  0.00890338283858717,
  -0.010999795747345185,
  0.011219504487719252,
  -0.009580523270229839,
  0.0060426568563437385,
  -0.0010367595046145348,
  -0.004524449920869577,
  0.009848526998710319,
  -0.014033456938243706,
  0.016156082944159714,
  -0.015619814914947197,
  0.012257274680972199,
  -0.006186862930843381,
  -0.0018729180726857802,
  0.01067514917087325,
  -0.019021794020038507,
  0.025356837085454886,
  -0.028162221256210537,
  0.02623007639845366,
  -0.019018102351278585,
  0.0063537576488700235,
  0.01127993327640622,
  -0.03261776323164456,
  0.05591478641436247,
  -0.07916460245900214,
  0.10019595709189351,
  -0.11691307170280156,
  0.1276537848308151,
  0.8686355318284121,
  0.1276537848308151,
  -0.11691307170280156,
  0.10019595709189351,
  -0.07916460245900214,
  0.05591478641436247,
  -0.03261776323164456,
  0.01127993327640622,
  0.0063537576488700235,
  -0.019018102351278585,
  0.02623007639845366,
  -0.028162221256210537,
  0.025356837085454886,
  -0.019021794020038507,
  0.01067514917087325,
  -0.0018729180726857802,
  -0.006186862930843381,
  0.012257274680972199,
  -0.015619814914947197,
  0.016156082944159714,
  -0.014033456938243706,
  0.009848526998710319,
  -0.004524449920869577,
  -0.0010367595046145348,
  0.0060426568563437385,
  -0.009580523270229839,
  0.011219504487719252,
  -0.010999795747345185,
  0.00890338283858717,
  -0.005537615079614365,
  0.0015206679529247257,
  0.0026165710564311005,
  -0.005936673826703775,
  0.008199110786132604,
  -0.008814738032636556,
  0.008067986819280814,
  -0.005908484547987026,
  0.0028598846625958905,
  0.0005838654280414387,
  -0.003815463498340431,
  0.006280343042208815,
  -0.007549771185039846,
  0.00745577248578239,
  -0.00605841222220879,
  0.003566617523000023,
  -0.0004086036221954815,
  -0.0028124490554282846,
  0.005527286968937268,
  -0.007197971275386966,
  0.007458508129006677,
  -0.006221168445066929,
  0.0036816362417962586,
  -0.00027385553960806265,
  -0.003349717219829301,
  0.0063703306589316,
  -0.008090051753305738,
  0.008009303921807376,
  -0.0059569232113415305,
  0.0022731723795717386,
  0.00226460953114351,
  -0.00656359581796631,
  0.009460202202241308,
  -0.009849171183218913,
  0.007246328530967606,
  -0.0020135585239935794,
  -0.004570678192305025,
  0.010416969763421885,
  -0.01315570140351435,
  0.010970799718855274,
  -0.0036140986284399594,
  -0.006936909349831065,
  0.01623436323498324,
  -0.018456893922803082,
  0.009308722245391797,
  0.009888252520662215,
  -0.028067038576290372,
  0.024742761850908904,
  0.01630770123311275,
  -0.06396748769382216,
  -0.06033776434504067,
  -0.01482969765384599
};

void SampleFilter_init(SampleFilter* f) {
  int i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void SampleFilter_put(SampleFilter* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == SAMPLEFILTER_TAP_NUM)
    f->last_index = 0;
}

double SampleFilter_get(SampleFilter* f) {
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : SAMPLEFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
